<h3>Overview</h3>
<p><span style="font-weight: 400;">Customers may have a long-running job in their build pipeline that they want to continue to run in an external service that will route to CircleCI. Then the workflow execution should be able to be paused or stopped, and then have an external trigger that will continue the necessary workflow via API v2.</span></p>
<h3>Solution</h3>
<p><span style="font-weight: 400;">A solution meeting these criteria would be to split the existing pipeline into two workflows and make use of </span><a href="https://circleci.com/docs/2.0/pipeline-variables/#pipeline-parameters-in-configuration"><span style="font-weight: 400;">pipeline parameters</span></a><span style="font-weight: 400;">. The external service would utilize our </span><a href="https://circleci.com/docs/api/v2/#operation/triggerPipeline"><span style="font-weight: 400;">TriggerPipeline API</span></a><span style="font-weight: 400;"> with the necessary pipeline parameters to trigger the second workflow.</span></p>
<p><span style="font-weight: 400;">Here is an example configuration with pseudo-code:</span></p>
<pre style="background-color: #f3f3f3;"><span style="font-weight: 400;"># pipeline parameters<br></span><br><span style="font-weight: 400;">external_service_work_done:</span><br><span style="font-weight: 400;">  type: boolean</span><br><span style="font-weight: 400;">  default: false</span><br><br><span style="font-weight: 400;"># &amp; possibly more parameters to contain the information from the remote external service (e.g., job 2's ID, branch, etc)</span><br><br><span style="font-weight: 400;">workflow 1:</span><br><span style="font-weight: 400;">   cond: not &lt;&lt; pipeline.parameters.external_service_work_done &gt;&gt;</span><br><span style="font-weight: 400;">   - job 1</span><br><span style="font-weight: 400;">   - job 2</span><br><span style="font-weight: 400;">   - command or job that notifies individual that external service work has started (e.g., through Slack)</span><br><br><span style="font-weight: 400;">workflow 2:</span><br><span style="font-weight: 400;">  cond: &lt;&lt; pipeline.parameters.external_service_work_done &gt;&gt;</span><br><span style="font-weight: 400;">  - command or job that notifies we are resuming this pipeline since external service work has completed (e.g., through Slack)</span><br><span style="font-weight: 400;">  - job 3</span><br><span style="font-weight: 400;">  - job 4</span></pre>
<p> </p>
<h3>Additional Resources</h3>
<p><span style="font-weight: 400;">these are some helpful documents on conditional workflows and triggering a workflow via </span><a href="https://circleci.com/docs/api/v2/"><span style="font-weight: 400;">API v2</span></a><span style="font-weight: 400;"> that are relevant to the scenario:</span></p>
<p><a href="https://support.circleci.com/hc/en-us/articles/360043638052-Conditional-steps-in-jobs-and-conditional-workflows"><span style="font-weight: 400;">https://support.circleci.com/hc/en-us/articles/360043638052-Conditional-steps-in-jobs-and-conditional-workflows</span></a></p>
<p><a href="https://support.circleci.com/hc/en-us/articles/360050351292-How-to-trigger-a-workflow-via-CircleCI-API-v2"><span style="font-weight: 400;">https://support.circleci.com/hc/en-us/articles/360050351292-How-to-trigger-a-workflow-via-CircleCI-API-v2</span></a></p>
<p><strong>Note</strong><span style="font-weight: 400;">: Should the external service not succeed due to an error then this could cause the workflow to continuously wait for a status update. Please ensure that a recovery method is in place should this situation occur and exit the respective workflow.</span></p>
<h3>Follow-Up</h3>
<figure class="quote"><em><span style="font-weight: 400;">Is there a way to indicate remote work status when the remote work triggers the workflow to continue?</span></em></figure>
<p><span style="font-weight: 400;">This will depend on context:</span></p>
<ul>
    <li><span style="font-weight: 400;">If the situation is about indicating to CircleCI (workflow 2) specifically, then one can set up a pipeline parameter to indicate whether the remote work status is good. In this way, workflow 2 will know if the remote service either succeeded or failed.</span></li>
    <li><span style="font-weight: 400;">If the approach is about notifying one's teams, then using our <a href="https://circleci.com/developer/orbs/orb/circleci/slack" target="_self">Slack orb</a> to <a href="https://circleci.com/docs/2.0/notifications/#using-the-slack-orb" target="_self">send notifications</a> can be a viable strategy as well.</span></li>
</ul>
<p> </p>